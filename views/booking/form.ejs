<%- include('../partials/header') %>

<div class="d-flex" id="wrapper">
  <!-- Sidebar -->
  <%- include('../partials/sidebar') %>

  <!-- Page Content -->
  <div id="page-content-wrapper">
    <!-- Navbar -->
    <%- include('../partials/navbar') %>

    <div class="container-fluid px-4">
      <h1 class="mt-4">Formulir Reservasi</h1>
      <p>Lengkapi detail pesanan Anda untuk <strong><%= gedung.namaGedung %></strong>.</p>

      <div class="card shadow-sm">
        <div class="card-body">
          <div class="row">
            <div class="col-md-5">
              <img src="<%= gedung.gambarUrl %>" class="img-fluid rounded" alt="<%= gedung.namaGedung %>" />
              <h4 class="mt-3"><%= gedung.namaGedung %></h4>
              <p class="text-muted"><%= gedung.alamat %></p>
              <h5>Rp <%= gedung.hargaSewa.toLocaleString('id-ID') %> / hari</h5>
            </div>
            <div class="col-md-7">
              <form action="/booking/create" method="POST">
                <input type="hidden" name="gedungId" value="<%= gedung._id %>" />

                <div class="mb-3">
                  <label for="tanggalCheckIn" class="form-label">Tanggal Check-in</label>
                  <input type="date" class="form-control" id="tanggalCheckIn" name="tanggalCheckIn" required />
                </div>

                <div class="mb-3">
                  <label for="tanggalCheckOut" class="form-label">Tanggal Check-out</label>
                  <input type="date" class="form-control" id="tanggalCheckOut" name="tanggalCheckOut" required />
                </div>

                <hr />

                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h5>Durasi Menginap:</h5>
                  <h5 id="durasi" class="fw-bold">0 Hari</h5>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                  <h3>Total Biaya:</h3>
                  <h3 id="totalBiaya" class="fw-bold text-success">Rp 0</h3>
                </div>

                <div class="d-grid mt-4">
                  <button type="submit" class="btn btn-primary btn-lg">Konfirmasi Pesanan</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const checkInInput = document.getElementById('tanggalCheckIn');
  const checkOutInput = document.getElementById('tanggalCheckOut');
  const durasiEl = document.getElementById('durasi');
  const totalBiayaEl = document.getElementById('totalBiaya');
  const hargaSewa = <%= gedung.hargaSewa %>;

  // Set tanggal minimal untuk check-in adalah hari ini
  const today = new Date().toISOString().split('T')[0];
  checkInInput.setAttribute('min', today);

  function calculateTotal() {
      const checkInDate = new Date(checkInInput.value);
      const checkOutDate = new Date(checkOutInput.value);

      if (checkInInput.value && checkOutInput.value && checkOutDate > checkInDate) {
          // Set tanggal minimal untuk check-out adalah setelah check-in
          checkOutInput.setAttribute('min', checkInInput.value);

          const timeDiff = checkOutDate.getTime() - checkInDate.getTime();
          const dayDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));

          const total = dayDiff * hargaSewa;

          durasiEl.textContent = `${dayDiff} Hari`;
          totalBiayaEl.textContent = `Rp ${total.toLocaleString('id-ID')}`;
      } else {
          durasiEl.textContent = '0 Hari';
          totalBiayaEl.textContent = 'Rp 0';
      }
  }

  checkInInput.addEventListener('change', calculateTotal);
  checkOutInput.addEventListener('change', calculateTotal);
</script>

<%- include('../partials/footer') %>
